#!/usr/bin/env python3
from scapy.all import *  # 保留基础层（如 Ether, LLC, sendp）
from scapy.contrib.gxrp import *  # 加载 GARP/GVRP 扩展层

# GARP_DEST 等常量不变
GARP_DEST = "01:80:c2:00:00:21"
MY_MAC    = "00:11:22:33:44:55"  # 或用 get_if_hwaddr(iface)

# 你的原函数，现在能用了
def send_gvrp_join(iface, vlans):
    for vlan in vlans:
        pkt = Ether(src=MY_MAC, dst=GARP_DEST)/ \
              LLC(dsap=0x42, ssap=0x42, ctrl=3)/ \
              GARP()/ \
              GVRP()/ \
              GVRPAttribute(event=2, value=vlan)   # event=2: JoinIn/JoinEmpty
        
        pkt = pkt / GVRPEndMark()
        sendp(pkt, iface=iface, verbose=0)
        print(f"[+] Sent GVRP Join VLAN {vlan} on {iface}")

# 示例
if __name__ == "__main__":
    iface = "eth1"
    vlans_to_join = [10, 20, 100, 666]
    send_gvrp_join(iface, vlans_to_join)